---
resource_Types:
  - name: maven-resource
    type: registry-image
    source:
      repository: nulldriver/maven-resource
      tag: latest

# We care when the source, ci/scripts, and ci/tasks code changes.
resources:
  - name: main
    icon: github
    type: git
    source:
      paths:
        - src/**
        - ci/scripts/**
        - ci/tasks/**
      branch: main
      uri: https://github.com/dumptruckman/multiverse-core-testing

  - name: artifact
    type: maven-resource
    source:
      url: http://localhost:8081/nexus/content/groups/public/
      artifact: com.dumptruckman:multiverse-core:jar
      username: admin
      password: admin123

groups:
  - name: deployments
    jobs:
      #      - unit-tests
      - package

jobs:

  #####################
  ##     TESTING     ##
  #####################
  # commented out due to kernel bug
  #  - name: unit-tests
  #    serial_groups: [staging]
  #    plan:
  #      - get: gls-api-src
  #        trigger: true
  #      - task: unit-tests
  #        file: gls-api-src/ci/tasks/unit-tests.yml

  #####################
  ##     BUILD       ##
  #####################

  - name: package
    build_logs_to_retain: 50
    plan:
      - get: main
        trigger: true
      #        passed: [unit-tests]
      - task: maven-package
        file: main/ci/tasks/maven-package.yml
      - put: artifact
        params:
          file: jar/Multiverse-Core-*.jar
          pom_file: main/pom.xml